Index: configure
===================================================================
--- configure	(revision 23570)
+++ configure	(working copy)
@@ -60,6 +60,7 @@
 _build_lure=no
 _build_cine=no
 _build_agi=no
+_build_kom=no
 _need_memalign=no
 _build_plugins=no
 _nasm=auto
@@ -314,6 +315,7 @@
   --enable-lure            build the Lure of the Temptress engine
   --enable-cine            build the Cinematique engine evo 1
   --enable-agi             build the AGI engine
+  --enable-kom             build the Kingdom O' Magic engine
   --enable-plugins         build engines as loadable modules instead of
                            static linking them
   --disable-mt32emu        don't enable the integrated MT-32 emulator
@@ -382,6 +384,7 @@
       --enable-lure)            _build_lure=yes ;;
       --enable-cine)            _build_cine=yes ;;
       --enable-agi)             _build_agi=yes ;;
+      --enable-kom)             _build_kom=yes ;;
       --disable-hq-scalers)     _build_hq_scalers=no ;;
       --disable-scalers)        _build_scalers=no ;;
       --enable-alsa)            _alsa=yes       ;;
@@ -727,6 +730,12 @@
 	_mak_agi='# DISABLE_AGI = 1'
 fi
 
+if test "$_build_kom" = no ; then
+	_mak_kom='DISABLE_KOM = 1'
+else
+	_mak_kom='# DISABLE_KOM = 1'
+fi
+
 if test "$_build_hq_scalers" = no ; then
 	_mak_hq_scalers='DISABLE_HQ_SCALERS = 1'
 else
@@ -1298,10 +1307,12 @@
 if test "$_build_cine" = yes ; then
 	echo "    Cinematique evo 1"
 fi
-
 if test "$_build_agi" = yes ; then
 	echo "    AGI"
 fi
+if test "$_build_kom" = yes ; then
+	echo "    Kingdom O' Magic"
+fi
 
 echo
 
@@ -1441,6 +1452,7 @@
 $_mak_lure
 $_mak_cine
 $_mak_agi
+$_mak_kom
 $_mak_mt32emu
 
 $_mak_hq_scalers
Index: engines/module.mk
===================================================================
--- engines/module.mk	(revision 23570)
+++ engines/module.mk	(working copy)
@@ -79,3 +79,8 @@
 MODULES += engines/agi
 endif
 
+ifdef DISABLE_KOM
+DEFINES += -DDISABLE_KOM
+else 
+MODULES += engines/kom
+endif
Index: base/plugins.cpp
===================================================================
--- base/plugins.cpp	(revision 23570)
+++ base/plugins.cpp	(working copy)
@@ -371,6 +371,9 @@
 	#ifndef DISABLE_AGI
 	LINK_PLUGIN(AGI)
 	#endif
+	#ifndef DISABLE_KOM
+	LINK_PLUGIN(KOM)
+	#endif
 
 #endif
 }
